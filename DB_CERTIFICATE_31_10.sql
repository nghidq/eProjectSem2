CREATE DATABASE DBTEST_CER
GO
USE DBTEST_CER
GO
CREATE TABLE USERS(
	USERS_ID INT PRIMARY KEY,
	USERNAME NVARCHAR(40) NOT NULL,
	PASSWORDS NVARCHAR(40) NOT NULL,
	FULLNAME NVARCHAR(100) NOT NULL,
	GENDER NVARCHAR(6) NOT NULL,
	DOB DATE NOT NULL,
	PHONE INT NOT NULL,
	EMAIL NVARCHAR(40) NOT NULL,
	USERS_ADD NVARCHAR(100) NOT NULL,
	--CONSTRAINT CHECK_DOB CHECK(CONVERT(DATE,DOB,101) <= CONVERT(DATE,(GETDATE()-5475),101))
	--CONSTRAINT CHECK_DOB CHECK(DATEDIFF(YEAR,CONVERT(DATE,DOB,101), GETDATE()) = 15)
	CONSTRAINT CHECK_DOB_USER CHECK(YEAR(CONVERT(DATE,DOB,101)) <= YEAR(GETDATE())-24)
)
GO
--(USERS_ID,USERNAME,PASSWORDS,FULLNAME,GENDER,DOB,PHONE,EMAIL,USERS_ADD)
INSERT [dbo].[USERS]([USERS_ID], [USERNAME], [PASSWORDS], [FULLNAME], [GENDER], [DOB], [PHONE], [EMAIL], [USERS_ADD]) 
VALUES(1, N'DQNGHI', N'12345', N'NGHI DANG QUANG', N'FEMALE', CAST(N'1988-01-13' AS DATE), 1456789, N'DQNGHI26@GMAIL.COM', N'CAN THO')
INSERT INTO USERS VALUES(2,'NLKHANH','12345','KHANH NGUYEN LE','FEMALE','12/03/1990',123456789,'NLKHANH@GMAIL.COM','CAN THO')
INSERT INTO USERS VALUES(3,'TTTHANG','12345','THANG TO TOAN','FEMALE','12/03/1990',123456789,'TTTHANG@GMAIL.COM','CAN THO')
INSERT INTO USERS VALUES(4,'NPTHANH','12345','THANH NGUYEN PHUC','FEMALE','12/03/1990',123456789,'NPTHANH@GMAIL.COM','CAN THO')
GO
CREATE TABLE PERMISS(
	PER_ID INT PRIMARY KEY,
	PER_NAME NVARCHAR(40) NOT NULL
)
GO
INSERT INTO PERMISS(PER_ID,PER_NAME) VALUES(1,'ADMIN')
INSERT INTO PERMISS(PER_ID,PER_NAME) VALUES(2,'KEEPER')
INSERT INTO PERMISS(PER_ID,PER_NAME) VALUES(3,'MANAGER')
GO
CREATE TABLE USER_PERMISS(
	PER_ID INT,
	USERS_ID INT,
	CONSTRAINT PK_USER_PERMISS PRIMARY KEY(PER_ID,USERS_ID),
	CONSTRAINT FK_USER_PERMISS_PERID FOREIGN KEY(PER_ID) REFERENCES PERMISS(PER_ID),
	CONSTRAINT FK_USER_PERMISS_USERSID FOREIGN KEY(USERS_ID) REFERENCES USERS(USERS_ID)
)
GO
INSERT INTO USER_PERMISS(PER_ID,USERS_ID) VALUES(1,1)
INSERT INTO USER_PERMISS(PER_ID,USERS_ID) VALUES(3,1)
GO
CREATE TABLE DETAIL_PERMISS(
	DETPER_ID INT PRIMARY KEY,
	ACCTION_NAME NVARCHAR(20) NOT NULL,
	PER_DATE DATE NOT NULL,
	PER_ID INT CONSTRAINT FK_DETAIL_PERMISS FOREIGN KEY(PER_ID) REFERENCES PERMISS(PER_ID),
	CONSTRAINT CHECK_PERDATE CHECK(CONVERT(DATE,PER_DATE,101) >= CONVERT(DATE,GETDATE(),101))
)
GO
INSERT INTO DETAIL_PERMISS(DETPER_ID,ACCTION_NAME,PER_DATE,PER_ID) 
VALUES(1,'ADD','12/12/2019',1)
INSERT INTO DETAIL_PERMISS(DETPER_ID,ACCTION_NAME,PER_DATE,PER_ID) 
VALUES(2,'EDIT','12/12/2019',1)
INSERT INTO DETAIL_PERMISS(DETPER_ID,ACCTION_NAME,PER_DATE,PER_ID) 
VALUES(3,'DETELE','12/12/2019',1)
INSERT INTO DETAIL_PERMISS(DETPER_ID,ACCTION_NAME,PER_DATE,PER_ID) 
VALUES(4,'UPDATE','12/12/2019',1)
GO
CREATE TABLE STUDENTS(
	STUDENT_ID NVARCHAR(10) PRIMARY KEY,
	STUDENT_NAME NVARCHAR(50) NOT NULL,
	IDENTITY_CARD INT NOT NULL,
	DOB DATE NOT NULL,
	GENDER NVARCHAR(5) NOT NULL,
	PHONE INT NOT NULL,
	EMAIL NVARCHAR(20) NOT NULL,
	STUDENT_ADD NVARCHAR(100) NOT NULL,
	CONSTRAINT CHECK_DOB_STUDENT CHECK(YEAR(CONVERT(DATE,DOB,101)) <= YEAR(GETDATE())-6)
)
GO
INSERT [dbo].[STUDENTS] ([STUDENT_ID], [STUDENT_NAME], [IDENTITY_CARD], [DOB], [GENDER], [PHONE], [EMAIL], [STUDENT_ADD]) 
VALUES (N'ST01', N'Le Van Quyet', 302980780, CAST(N'1990-12-12' AS Date), N'Nam', 905682594, N'quyet@gmail.com', N'Can Tho')
INSERT [dbo].[STUDENTS] ([STUDENT_ID], [STUDENT_NAME], [IDENTITY_CARD], [DOB], [GENDER], [PHONE], [EMAIL], [STUDENT_ADD]) 
VALUES (N'ST02', N'Nguyen Thi Tam', 890228465, CAST(N'1991-01-01' AS Date), N'Nu', 905682595, N'tam@gmail.com', N'Vinh Long')
INSERT [dbo].[STUDENTS] ([STUDENT_ID], [STUDENT_NAME], [IDENTITY_CARD], [DOB], [GENDER], [PHONE], [EMAIL], [STUDENT_ADD])
VALUES (N'ST03', N'Doan Van Chien', 864536278, CAST(N'1992-03-20' AS Date), N'Nam', 905682596, N'chien@gmail.com', N'Dong Thap')
INSERT [dbo].[STUDENTS] ([STUDENT_ID], [STUDENT_NAME], [IDENTITY_CARD], [DOB], [GENDER], [PHONE], [EMAIL], [STUDENT_ADD]) 
VALUES (N'ST04', N'Tran Van Dau', 837261538, CAST(N'1993-04-23' AS Date), N'Nam', 905682597, N'dau@gmail.com', N'An Giang')
INSERT [dbo].[STUDENTS] ([STUDENT_ID], [STUDENT_NAME], [IDENTITY_CARD], [DOB], [GENDER], [PHONE], [EMAIL], [STUDENT_ADD]) 
VALUES (N'ST05', N'Le Thi Chac', 846362846, CAST(N'1989-08-06' AS Date), N'Nu', 905682598, N'chac@gmail.com', N'Long An')
INSERT [dbo].[STUDENTS] ([STUDENT_ID], [STUDENT_NAME], [IDENTITY_CARD], [DOB], [GENDER], [PHONE], [EMAIL], [STUDENT_ADD]) 
VALUES (N'ST06', N'Pham Van Chan', 364826243, CAST(N'1995-12-04' AS Date), N'Nam', 905682599, N'chan@gmail.com', N'Tien Giang')
INSERT [dbo].[STUDENTS] ([STUDENT_ID], [STUDENT_NAME], [IDENTITY_CARD], [DOB], [GENDER], [PHONE], [EMAIL], [STUDENT_ADD]) 
VALUES (N'ST07', N'Pham Nhat', 463528463, CAST(N'1999-11-07' AS Date), N'Nam', 905682600, N'nhat@gmail.com', N'Ca Mau')
INSERT [dbo].[STUDENTS] ([STUDENT_ID], [STUDENT_NAME], [IDENTITY_CARD], [DOB], [GENDER], [PHONE], [EMAIL], [STUDENT_ADD]) 
VALUES (N'ST08', N'Nguyen Khai Dinh', 284634636, CAST(N'2000-04-05' AS Date), N'Nam', 905682601, N'dinh@gmail.com', N'Bac Lieu')
INSERT [dbo].[STUDENTS] ([STUDENT_ID], [STUDENT_NAME], [IDENTITY_CARD], [DOB], [GENDER], [PHONE], [EMAIL], [STUDENT_ADD]) 
VALUES (N'ST09', N'Ly Van Thang', 636329367, CAST(N'1996-08-09' AS Date), N'Nam', 905682602, N'thang@gmail.com', N'Soc Trang')
INSERT [dbo].[STUDENTS] ([STUDENT_ID], [STUDENT_NAME], [IDENTITY_CARD], [DOB], [GENDER], [PHONE], [EMAIL], [STUDENT_ADD]) 
VALUES (N'ST10', N'Nguyen Thi Loi', 626384729, CAST(N'1994-12-07' AS Date), N'Nu', 905682603, N'loi@gmail.com', N'Tra Vinh')
GO
CREATE TABLE CERTIFICATED(
	CERTIFICATE_ID NVARCHAR(10),
	CERTIFICATE_NAME NVARCHAR(100) NOT NULL,
	CERTIFICATE_NUM NVARCHAR(10) NOT NULL,
	CONSTRAINT PK_CER PRIMARY KEY(CERTIFICATE_ID)
)
GO
INSERT [dbo].[CERTIFICATED] ([CERTIFICATE_ID], [CERTIFICATE_NAME], [CERTIFICATE_NUM]) 
VALUES (N'C01', N'English Level A', N'A0000')
INSERT [dbo].[CERTIFICATED] ([CERTIFICATE_ID], [CERTIFICATE_NAME], [CERTIFICATE_NUM]) 
VALUES (N'C02', N'English Level B', N'B0000')
INSERT [dbo].[CERTIFICATED] ([CERTIFICATE_ID], [CERTIFICATE_NAME], [CERTIFICATE_NUM]) 
VALUES (N'C03', N'English Level C', N'C0000')
INSERT [dbo].[CERTIFICATED] ([CERTIFICATE_ID], [CERTIFICATE_NAME], [CERTIFICATE_NUM]) 
VALUES (N'C04', N'Informatics Level A', N'AA000')
INSERT [dbo].[CERTIFICATED] ([CERTIFICATE_ID], [CERTIFICATE_NAME], [CERTIFICATE_NUM]) 
VALUES (N'C05', N'Informatics Level B', N'BB000')
GO
CREATE TABLE STUDENT_CER(
	STUDENT_ID NVARCHAR(10),
	CERTIFICATE_ID NVARCHAR(10),
	EXAM_DATE DATE,
	RESULT NVARCHAR(10),
	CONSTRAINT PK_STUDENT_CER PRIMARY KEY(STUDENT_ID,CERTIFICATE_ID,EXAM_DATE),
	CONSTRAINT FK_STUDENT_CER_STUDENTID FOREIGN KEY(STUDENT_ID) REFERENCES STUDENTS(STUDENT_ID),
	CONSTRAINT FK_STUDENTCER_CERTIFICATEID FOREIGN KEY(CERTIFICATE_ID) REFERENCES CERTIFICATED(CERTIFICATE_ID),
	CONSTRAINT CHECK_EXAMDATE CHECK (DATEDIFF(dd,GETDATE(),CONVERT(DATE,EXAM_DATE,101))>=30 and DATEDIFF(dd,GETDATE(),CONVERT(DATE,EXAM_DATE,101))<=365)
)
GO
INSERT [dbo].[STUDENT_CER] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [RESULT]) 
VALUES (N'ST01', N'C01', CAST(N'2019-12-30' AS Date), N'')
INSERT [dbo].[STUDENT_CER] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [RESULT]) 
VALUES (N'ST01', N'C01', CAST(N'2020-01-12' AS Date), N'')
INSERT [dbo].[STUDENT_CER] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [RESULT]) 
VALUES (N'ST02', N'C02', CAST(N'2019-12-31' AS Date), N'')
INSERT [dbo].[STUDENT_CER] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [RESULT]) 
VALUES (N'ST03', N'C03', CAST(N'2020-01-30' AS Date), N'')
INSERT [dbo].[STUDENT_CER] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [RESULT]) 
VALUES (N'ST04', N'C04', CAST(N'2020-01-16' AS Date), N'')
INSERT [dbo].[STUDENT_CER] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [RESULT]) 
VALUES (N'ST04', N'C04', CAST(N'2020-01-18' AS Date), N'')
INSERT [dbo].[STUDENT_CER] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [RESULT]) 
VALUES (N'ST04', N'C04', CAST(N'2020-01-17' AS Date), N'')
INSERT [dbo].[STUDENT_CER] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [RESULT]) 
VALUES (N'ST05', N'C05', CAST(N'2020-01-17' AS Date), N'')
INSERT [dbo].[STUDENT_CER] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [RESULT]) 
VALUES (N'ST06', N'C01', CAST(N'2020-02-12' AS Date), N'')
INSERT [dbo].[STUDENT_CER] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [RESULT]) 
VALUES (N'ST06', N'C02', CAST(N'2019-12-30' AS Date), N'')
INSERT [dbo].[STUDENT_CER] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [RESULT]) 
VALUES (N'ST07', N'C02', CAST(N'2019-12-31' AS Date), N'')
INSERT [dbo].[STUDENT_CER] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [RESULT]) 
VALUES (N'ST08', N'C03', CAST(N'2019-12-30' AS Date), N'')
INSERT [dbo].[STUDENT_CER] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [RESULT]) 
VALUES (N'ST09', N'C04', CAST(N'2020-01-18' AS Date), N'')
INSERT [dbo].[STUDENT_CER] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [RESULT]) 
VALUES (N'ST10', N'C05', CAST(N'2020-01-25' AS Date), N'')
GO
CREATE TABLE DETAIL_CERTIFICATE(
	SUBJECT_ID NVARCHAR(5) PRIMARY KEY,
	SUBJECT_NAME NVARCHAR(100) NOT NULL,
	CERTIFICATE_ID NVARCHAR(10),
	CONSTRAINT FK_DETAIL_CERTIFICATE FOREIGN KEY(CERTIFICATE_ID) REFERENCES CERTIFICATED(CERTIFICATE_ID)
)
GO
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ01', N'Listening A', N'C01')
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ02', N'Speaking A', N'C01')
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ03', N'Reading A', N'C01')
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ04', N'Writing A', N'C01')
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ05', N'Listening B', N'C02')
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ06', N'Speaking B', N'C02')
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ07', N'Reading B', N'C02')
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ08', N'Writing B', N'C02')
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ09', N'Listening C', N'C03')
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ10', N'Speaking C', N'C03')
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ11', N'Reading C', N'C03')
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ12', N'Writing C', N'C03')
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ17', N'Practice A', N'C04')
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ18', N'Theory A', N'C04')
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ19', N'Practice B', N'C05')
INSERT [dbo].[DETAIL_CERTIFICATE] ([SUBJECT_ID], [SUBJECT_NAME], [CERTIFICATE_ID]) 
VALUES (N'SJ20', N'Theory B', N'C05')
GO
CREATE TABLE EXAM_MARK(
	STUDENT_ID NVARCHAR(10),
	CERTIFICATE_ID NVARCHAR(10),
	EXAM_DATE DATE,
	SUBJECT_ID NVARCHAR(5),
	MARK FLOAT NULL,
	CONSTRAINT PK_EXAMMARK  PRIMARY KEY(STUDENT_ID,CERTIFICATE_ID,EXAM_DATE,SUBJECT_ID),
	CONSTRAINT FK_EXAMMARK_STUDENT_CER FOREIGN KEY(STUDENT_ID,CERTIFICATE_ID,EXAM_DATE) REFERENCES STUDENT_CER(STUDENT_ID,CERTIFICATE_ID,EXAM_DATE),
	CONSTRAINT FK_EXAMMARK_SUBJECTID FOREIGN KEY(SUBJECT_ID) REFERENCES DETAIL_CERTIFICATE(SUBJECT_ID)
)
GO
INSERT [dbo].[EXAM_MARK] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [SUBJECT_ID], [MARK]) 
VALUES (N'ST01', N'C01', CAST(N'2019-12-30' AS Date), N'SJ01', 5)
INSERT [dbo].[EXAM_MARK] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [SUBJECT_ID], [MARK]) 
VALUES (N'ST01', N'C01', CAST(N'2020-01-12' AS Date), N'SJ03', 3)
INSERT [dbo].[EXAM_MARK] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [SUBJECT_ID], [MARK]) 
VALUES (N'ST04', N'C04', CAST(N'2020-01-16' AS Date), N'SJ17', 3)
INSERT [dbo].[EXAM_MARK] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [SUBJECT_ID], [MARK]) 
VALUES (N'ST04', N'C04', CAST(N'2020-01-16' AS Date), N'SJ18', 4) 
INSERT [dbo].[EXAM_MARK] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [SUBJECT_ID], [MARK]) 
VALUES (N'ST06', N'C01', CAST(N'2020-02-12' AS Date), N'SJ03', 9)
INSERT [dbo].[EXAM_MARK] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [SUBJECT_ID], [MARK]) 
VALUES (N'ST06', N'C01', CAST(N'2020-02-12' AS Date), N'SJ04', 7)
INSERT [dbo].[EXAM_MARK] ([STUDENT_ID], [CERTIFICATE_ID], [EXAM_DATE], [SUBJECT_ID], [MARK]) 
VALUES (N'ST09', N'C04', CAST(N'2020-01-18' AS Date), N'SJ17', 8)



